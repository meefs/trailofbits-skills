{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "zeroize-audit input",
  "type": "object",
  "properties": {
    "path": { "type": "string", "description": "Repository root path" },
    "compile_db": { "type": ["string", "null"], "default": null, "description": "Path to compile_commands.json for C/C++ analysis. Required if cargo_manifest is not set." },
    "cargo_manifest": { "type": ["string", "null"], "default": null, "description": "Path to Cargo.toml for Rust crate analysis. Required if compile_db is not set." },
    "config": { "type": ["string", "null"], "description": "Path to config YAML" },
    "opt_levels": {
      "type": "array",
      "items": { "type": "string", "enum": ["O0", "O1", "O2", "O3", "Os", "Oz"] },
      "default": ["O0", "O1", "O2"]
    },
    "languages": {
      "type": "array",
      "items": { "type": "string", "enum": ["c", "cpp", "rust"] },
      "default": ["c", "cpp", "rust"]
    },
    "max_tus": { "type": "integer", "minimum": 1, "default": 50 },
    "enable_semantic_ir": { "type": "boolean", "default": false, "description": "Enable semantic LLVM IR analysis" },
    "enable_cfg": { "type": "boolean", "default": false, "description": "Enable control-flow graph analysis" },
    "enable_runtime_tests": { "type": "boolean", "default": false, "description": "Enable runtime PoC test generation and execution" },
    "enable_asm": { "type": "boolean", "default": true, "description": "Enable assembly emission and analysis" },
    "mcp_mode": {
      "type": "string",
      "enum": ["off", "prefer", "require"],
      "default": "prefer",
      "description": "Control MCP semantic analysis usage"
    },
    "mcp_required_for_advanced": {
      "type": "boolean",
      "default": true,
      "description": "Downgrade advanced findings when MCP semantic evidence is unavailable"
    },
    "mcp_timeout_ms": {
      "type": "integer",
      "minimum": 100,
      "default": 10000,
      "description": "Timeout budget for MCP semantic queries"
    },
    "poc_categories": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "MISSING_SOURCE_ZEROIZE",
          "PARTIAL_WIPE",
          "NOT_ON_ALL_PATHS",
          "OPTIMIZED_AWAY_ZEROIZE",
          "STACK_RETENTION",
          "REGISTER_SPILL",
          "SECRET_COPY",
          "INSECURE_HEAP_ALLOC",
          "MISSING_ON_ERROR_PATH",
          "NOT_DOMINATING_EXITS",
          "LOOP_UNROLLED_INCOMPLETE"
        ]
      },
      "default": [
        "MISSING_SOURCE_ZEROIZE",
        "PARTIAL_WIPE",
        "NOT_ON_ALL_PATHS",
        "OPTIMIZED_AWAY_ZEROIZE",
        "STACK_RETENTION",
        "REGISTER_SPILL",
        "SECRET_COPY",
        "INSECURE_HEAP_ALLOC",
        "MISSING_ON_ERROR_PATH",
        "NOT_DOMINATING_EXITS",
        "LOOP_UNROLLED_INCOMPLETE"
      ],
      "description": "Finding categories for which to generate PoCs"
    },
    "poc_output_dir": {
      "type": ["string", "null"],
      "default": null,
      "description": "Output directory for generated PoCs (default: generated_pocs/)"
    }
  },
  "required": ["path"],
  "additionalProperties": false
}
