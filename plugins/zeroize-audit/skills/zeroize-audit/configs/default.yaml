version: 0.1.0

languages:
  - c
  - cpp
  - rust

# Pattern-specific configs (register_spill_patterns, callee_saved_registers,
# asm_wipe_patterns, ir_wipe_patterns, secret_copy_patterns, cfg_patterns,
# ir_semantic_patterns) are defined directly in their analysis scripts.

# Heuristic sensitivity signals
sensitive_name_regex:
  - "(?i)\\b(secret|key|seed|priv|private|sk|shared[_-]?secret|nonce|token|pwd|pass(word)?)\\b"
  - "(?i)\\b(master[_-]?key|session[_-]?key|api[_-]?key)\\b"

# Optional annotation/macros that should flip needs_review=false
explicit_sensitive_markers:
  - "annotate(\"sensitive\")"
  - "SENSITIVE"
  - "#\\[secret\\]"
  - "Secret<"
  - "secrecy::Secret"

# Approved wipe function names (source-level)
approved_wipe_funcs:
  - "explicit_bzero"
  - "memset_s"
  - "SecureZeroMemory"
  - "OPENSSL_cleanse"
  - "sodium_memzero"
  - "zeroize"          # rust crate fn (name-only heuristic)
  - "Zeroize::zeroize" # rust trait call heuristic
  - "zeroize::Zeroize::zeroize"

# Patterns to recognize volatile wipe loops / barriers (source-level heuristics)
volatile_wipe_regex:
  - "(?s)volatile\\s+.*\\*.*=\\s*0"
  - "(?s)asm\\s+volatile\\s*\\(\\s*\"\"\\s*:\\s*:\\s*:\\s*\"memory\"\\s*\\)"
  - "(?s)__asm__\\s+__volatile__\\s*\\(\\s*\"\"\\s*:\\s*:\\s*:\\s*\"memory\"\\s*\\)"

# "Wrong size" heuristics (common bug: sizeof(ptr))
wrong_size_regex:
  - "memset\\s*\\(\\s*\\w+\\s*,\\s*0\\s*,\\s*sizeof\\s*\\(\\s*\\w+\\s*\\*\\s*\\)\\s*\\)"
  - "explicit_bzero\\s*\\(\\s*\\w+\\s*,\\s*sizeof\\s*\\(\\s*\\w+\\s*\\*\\s*\\)\\s*\\)"

# Insecure heap allocators (should use secure variants)
insecure_heap_alloc_patterns:
  - pattern: "malloc\\s*\\([^)]*\\)"
    secure_alternative: "OPENSSL_secure_malloc / sodium_malloc"
  - pattern: "calloc\\s*\\([^)]*\\)"
    secure_alternative: "OPENSSL_secure_zalloc / sodium_allocarray"
  - pattern: "realloc\\s*\\([^)]*\\)"
    secure_alternative: "OPENSSL_secure_realloc"
  - pattern: "new\\s+\\w*(?:key|secret|token|pwd)\\w*"
    secure_alternative: "custom allocator with mlock"

# Secure heap allocators (approved)
secure_heap_alloc_funcs:
  - "OPENSSL_secure_malloc"
  - "OPENSSL_secure_zalloc"
  - "OPENSSL_secure_realloc"
  - "sodium_malloc"
  - "sodium_allocarray"
  - "SecureAlloc"  # Custom implementations

# Memory protection functions
memory_protection_funcs:
  lock:
    - "mlock"
    - "mlock2"
    - "mlockall"
  advise:
    - "madvise.*MADV_DONTDUMP"
    - "madvise.*MADV_DONTFORK"
    - "madvise.*MADV_WIPEONFORK"

# === Medium Priority Features (v0.3.0) ===

# Semantic IR analysis configuration
semantic_ir_analysis:
  enabled: true
  detect_loop_unrolling: true
  detect_phi_nodes: true
  min_unrolled_stores: 4  # Minimum consecutive stores to flag as unrolled loop
  track_ssa_form: true

# Control-flow analysis configuration
cfg_analysis:
  enabled: true
  verify_all_paths: true
  compute_dominators: true
  detect_early_returns: true
  max_paths_to_analyze: 1000  # Limit for performance

# Runtime validation configuration
runtime_validation:
  generate_tests: true
  test_types:
    - basic          # Basic memory check tests
    - msan           # MemorySanitizer tests
    - valgrind       # Valgrind tests
    - stack_canary   # Stack retention tests
  sanitizers:
    - memory         # -fsanitize=memory
    - address        # -fsanitize=address

# PoC generation configuration
# NOTE: PoC generation is always mandatory in the pipeline. This section
# controls PoC parameters (categories, thresholds, etc.), not whether PoCs run.
poc_generation:
  enabled: true
  categories:
    - MISSING_SOURCE_ZEROIZE
    - OPTIMIZED_AWAY_ZEROIZE
    - STACK_RETENTION
    - REGISTER_SPILL
    - SECRET_COPY
    - MISSING_ON_ERROR_PATH
    - PARTIAL_WIPE
    - NOT_ON_ALL_PATHS
    - INSECURE_HEAP_ALLOC
    - LOOP_UNROLLED_INCOMPLETE
    - NOT_DOMINATING_EXITS
  source_inclusion_threshold: 5000
  output_dir: generated_pocs
  stack_probe_max_size: 4096
  secret_fill_byte: 0xAA
